# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

SportSync is a static website that displays a personalized sports dashboard using live data from various sports APIs. It focuses on upcoming events for football, golf, tennis, Formula 1, chess, and esports, with Norway-centric time formatting and preferences. The site is automatically updated via GitHub Actions and hosted on GitHub Pages.

## Architecture

This is a hybrid static/dynamic application:
- **Static Frontend**: Pure HTML/CSS/JS hosted on GitHub Pages
- **Automated Data Fetching**: GitHub Actions fetch fresh API data every 6 hours
- **Cached Data Strategy**: Pre-fetched JSON files with live API fallbacks
- **No Backend**: Serverless architecture using only GitHub infrastructure

### Key Components

- **docs/index.html** - Main dashboard with ultra-minimal embedded CSS
- **docs/js/dashboard.js** - Dashboard controller (temporal bands, expand/collapse, filters)
- **docs/js/dashboard-helpers.js** - Pure utility functions (grouping, brief generation, countdowns)
- **docs/js/asset-maps.js** - Team logo and golfer headshot URL mappings
- **docs/js/sport-config.js** - Sport metadata (emoji, color, aliases)
- **docs/js/sports-api.js** - API integration layer with cached data priority
- **docs/js/preferences-manager.js** - Favorites storage (localStorage)
- **docs/data/** - Pre-fetched JSON data files (auto-generated by GitHub Actions)
- **.github/workflows/update-sports-data.yml** - Automated data fetching workflow

### Data Flow

1. **GitHub Actions** run every 6 hours to fetch fresh sports data
2. **API calls** to TheSportsDB, ESPN, and other sources
3. **JSON files** are generated and committed to `docs/data/`
4. **Client-side JavaScript** loads cached data first, falls back to live APIs
5. **Dashboard** displays data with Norwegian timezone formatting

## Development Commands

- `npm run dev` - Start local development server (Python HTTP server on port 8000)
- `npm run build` - No build step required (static site)
- `npm run deploy` - Automatic deployment via GitHub Pages

## GitHub Actions Workflow

The **update-sports-data.yml** workflow:
- **Trigger**: Every 6 hours (00:00, 06:00, 12:00, 18:00 UTC) + manual dispatch
- **Fetches**: Football, Golf, Tennis, F1 data from free APIs
- **Generates**: Chess and Esports curated data
- **Commits**: Updated JSON files to repository
- **Deploys**: Automatically via GitHub Pages

### Workflow Features
- Error handling with fallback data
- Dependency-free Node.js execution
- Commit summaries with event counts
- Timezone-aware timestamps

## API Integration Strategy

**Priority order for each sport:**
1. **Pre-fetched data** from `docs/data/*.json` (updated by GitHub Actions)
2. **Live API calls** as fallback (TheSportsDB, ESPN)
3. **Mock data** as final fallback for development/errors

**APIs Used:**
- **TheSportsDB** - Football (Premier League) and Tennis events
- **ESPN Public API** - Golf (PGA Tour) and Formula 1 events
- **Curated Data** - Chess tournaments and Esports competitions

## File Structure

```
docs/
├── index.html              # Main dashboard (HTML + embedded CSS)
├── sw.js                   # Service worker for caching
├── js/
│   ├── dashboard.js        # Dashboard controller (temporal bands, expand/collapse)
│   ├── dashboard-helpers.js # Pure utilities (grouping, brief, countdowns)
│   ├── asset-maps.js       # Team logos + golfer headshot URLs
│   ├── sport-config.js     # Sport metadata (emoji, color, aliases)
│   ├── sports-api.js       # API integration with cached data priority
│   └── preferences-manager.js # Favorites storage (localStorage)
└── data/                   # Pre-fetched API data (auto-generated)
    ├── events.json         # Unified events feed (main data source)
    ├── football.json       # Football events + metadata
    ├── golf.json           # Golf tournaments + metadata
    ├── tennis.json         # Tennis matches + metadata
    ├── f1.json             # Formula 1 races + metadata
    ├── chess.json          # Chess tournaments + metadata
    ├── esports.json        # Esports competitions + metadata
    └── meta.json           # Update timestamps

.github/workflows/
└── update-sports-data.yml  # Automated data fetching workflow
```

## Development Notes

- **No build process** - pure static files with embedded CSS
- **Modern JavaScript** - ES6+ features, async/await patterns
- **Norwegian focus** - Europe/Oslo timezone, Norwegian teams prioritized
- **Error resilience** - Multiple fallback layers for robust operation
- **GitHub Pages** - Automatic deployment on push to main branch
- **Ultra-minimal design** - 540px reading column, no cards/badges/shadows
- **Temporal bands** - Events grouped into Today/Tomorrow/This Week/Later
- **Tournament grouping** - 3+ events from same tournament get a header
- **Click-to-expand** - Event rows expand to show venue, logos, streaming, favorites

## Extending the Dashboard

To add a new sport:
1. Add API fetching logic to the GitHub Actions workflow
2. Add sport config to `docs/js/sport-config.js`
3. Add filter dot to `docs/index.html`
4. Events will auto-display via temporal band grouping in `dashboard.js`

To add premium APIs:
1. Add API keys as GitHub Secrets
2. Update workflow to use authenticated endpoints
3. Modify error handling for rate limits

## Automation Rules

These rules govern automated Claude Code operations via GitHub Actions (`claude-code-action`).

### Protected Paths (never modify automatically)
- `.github/workflows/**`
- `package.json`, `package-lock.json`
- `.env*`
- `.git/**`
- `node_modules/**`

### Allowed Paths
- `scripts/**`
- `tests/**`
- `docs/js/**`
- `docs/index.html`
- `docs/*.md`
- `docs/sw.js`
- `docs/css/**`
- `AUTOPILOT_ROADMAP.md`
- `docs/data/autopilot-log.json`

### Change Limits
- Maximum **8 files** per automated PR
- Maximum **300 lines changed** per automated PR
- One bounded fix per maintenance run

### Risk Classification
- **LOW** — typo fixes, comment updates, test additions → auto-PR
- **MEDIUM** — logic changes, dependency updates, config changes → PR + request review
- **HIGH** — workflow changes, auth changes, data schema changes → skip (create issue only)

### Testing
- Always run `npm test` before committing
- If tests fail, revert changes and report in the PR or issue

### Branch Naming
- All automated branches must use the prefix `claude/`
- Autopilot branches use the prefix `claude/improve-`

### Autopilot

The autopilot workflow (`claude-autopilot.yml`) proactively improves the codebase using a roadmap-driven approach:

- **Roadmap**: `AUTOPILOT_ROADMAP.md` is the prioritized task queue
- **Cadence**: Runs nightly at 03:00 UTC
- **PR label**: `autopilot`
- **Multi-task loop**: The autopilot works through PENDING tasks continuously until it runs out of turns, tasks, or hits an error
- **Auto-merge**: Each task is branched, PR'd, and merged immediately after tests pass
- **Self-curating**: After completing tasks, the autopilot scouts the codebase for new improvement opportunities and appends them to the roadmap
- **Safe stops**: If tests fail or a merge fails, the loop stops — no broken code gets pushed
- **Human control**: Reorder tasks in the roadmap to change priority. Mark tasks `[BLOCKED]` to skip them.